<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø¬Ù„ ØµÙ…Ø§Ù…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… - Control Valves Log</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --sub-text: #7f8c8d;
            --border-color: #eee;
            --primary-color: #007bff;
            --th-bg: #34495e;
            --th-text: #ffffff;
            --hover-bg: #f1f1f1;
            --shadow: rgba(0,0,0,0.05);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #121212;
                --card-bg: #1e1e1e;
                --text-color: #e0e0e0;
                --sub-text: #b0b3b8;
                --border-color: #333;
                --primary-color: #4dabf7;
                --th-bg: #2c2c2c;
                --th-text: #ffffff;
                --hover-bg: #2a2a2a;
                --shadow: rgba(0,0,0,0.5);
            }
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); color: var(--text-color); padding: 20px; margin: 0; transition: background-color 0.3s, color 0.3s; }
        .container { max-width: 900px; margin: 30px auto; background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px var(--shadow); transition: background 0.3s; }
        
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .header-text { text-align: center; flex-grow: 1; }
        h2 { margin: 0; }
        p.subtitle { color: var(--sub-text); font-size: 14px; margin-top: 5px; }
        
        .controls { display: flex; gap: 10px; }
        .btn-toggle { background: none; border: 1px solid var(--border-color); color: var(--text-color); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-toggle:hover { background: var(--hover-bg); }

        .filters { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; background: var(--hover-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); }
        .form-group { display: flex; flex-direction: column; min-width: 200px; }
        label { font-size: 13px; font-weight: bold; margin-bottom: 5px; color: var(--text-color); }
        select { padding: 10px; border-radius: 6px; border: 1px solid var(--sub-text); font-size: 15px; background: var(--card-bg); color: var(--text-color); cursor: pointer; outline: none; }
        select:disabled { opacity: 0.6; cursor: not-allowed; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: inherit; border-bottom: 1px solid var(--border-color); }
        th { background-color: var(--th-bg); color: var(--th-text); width: 30%; }
        td { background-color: var(--card-bg); }
        
        .tag-badge { display: inline-block; background: rgba(0, 123, 255, 0.1); color: var(--primary-color); padding: 5px 10px; border-radius: 4px; font-weight: bold; font-family: monospace; border: 1px solid var(--primary-color); }
        .no-data { text-align: center; color: var(--sub-text); margin-top: 40px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="controls">
            <button class="btn-toggle" onclick="toggleLang()" id="langBtn">EN</button>
        </div>
        <div class="header-text">
            <h2 data-key="title">Ù‚Ø§Ø¦Ù…Ø© ØµÙ…Ø§Ù…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <p class="subtitle" data-key="subtitle">Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙÙ†ÙŠ</p>
        </div>
        <div style="width: 50px;"></div> </header>
    
    <div class="filters">
        <div class="form-group">
            <label data-key="lblType">Ù†ÙˆØ¹ Ø§Ù„ØµÙ…Ø§Ù…</label>
            <select id="controlType" onchange="populateNumbers()">
                <option value="" data-key="optSelect">-- Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ --</option>
            </select>
        </div>

        <div class="form-group">
            <label data-key="lblTag">Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù‚</label>
            <select id="controlNumber" onchange="showData()" disabled>
                <option value="" data-key="optSelectNum">-- Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚Ù… --</option>
            </select>
        </div>
    </div>

    <div id="resultArea">
        <div id="placeholder" class="no-data" data-key="placeholder">
            ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        </div>
        
        <table id="dataTable" style="display: none;">
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // --- 1. Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ±Ø¬Ù…Ø© ---
    const translations = {
        ar: {
            title: "Ù‚Ø§Ø¦Ù…Ø© ØµÙ…Ø§Ù…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…",
            subtitle: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙÙ†ÙŠ",
            lblType: "Ù†ÙˆØ¹ Ø§Ù„ØµÙ…Ø§Ù…",
            lblTag: "Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù‚",
            optSelect: "-- Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ --",
            optSelectNum: "-- Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚Ù… --",
            placeholder: "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„",
            langBtn: "English",
            fields: {
                Service: "Ø§Ù„Ø®Ø¯Ù…Ø© / Ø§Ù„ÙˆØ¸ÙŠÙØ©",
                Action: "Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ (Failure Action)",
                HandJack: "Hand Jack / Bypass",
                PEFS: "Ø±Ù‚Ù… Ø§Ù„Ù…Ø®Ø·Ø· (PEFS)",
                Location: "Ø§Ù„Ù…ÙˆÙ‚Ø¹",
                TagNo: "Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„"
            },
            types: {
                FV: "ØµÙ…Ø§Ù… ØªØ¯ÙÙ‚ (Flow Valve)",
                HV: "ØµÙ…Ø§Ù… ÙŠØ¯ÙˆÙŠ (Hand Valve)",
                LV: "ØµÙ…Ø§Ù… Ù…Ø³ØªÙˆÙ‰ (Level Valve)",
                PDV: "ØµÙ…Ø§Ù… ÙØ±Ù‚ Ø¶ØºØ· (Diff. Pressure)",
                PV: "ØµÙ…Ø§Ù… Ø¶ØºØ· (Pressure Valve)",
                TV: "ØµÙ…Ø§Ù… Ø­Ø±Ø§Ø±Ø© (Temp. Valve)"
            },
            actions: {
                FC: "ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (Fail to Close)",
                FO: "ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙØªØ­ (Fail to Open)",
                FL: "ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù‚ÙÙ„ (Fail to Lock)",
                "-": "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
            }
        },
        en: {
            title: "Control Valves List",
            subtitle: "Technical Inquiry System",
            lblType: "Valve Type",
            lblTag: "Tag Number",
            optSelect: "-- Select Type --",
            optSelectNum: "-- Select Number --",
            placeholder: "Please select data to view details",
            langBtn: "Ø¹Ø±Ø¨ÙŠ",
            fields: {
                Service: "Service Description",
                Action: "Failure Action",
                HandJack: "Hand Jack / Bypass",
                PEFS: "PEFS No.",
                Location: "Location",
                TagNo: "Full Tag No"
            },
            types: {
                FV: "Flow Valve (FV)",
                HV: "Hand Valve (HV)",
                LV: "Level Valve (LV)",
                PDV: "Pressure Diff. Valve (PDV)",
                PV: "Pressure Valve (PV)",
                TV: "Temperature Valve (TV)"
            },
            actions: {
                FC: "Fail to Close",
                FO: "Fail to Open",
                FL: "Fail to Lock",
                "-": "N/A"
            }
        }
    };

    // --- 2. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ÙˆØµÙ Ø§Ù„Ø·ÙˆÙŠÙ„ (Service/Location) ØªØ±ÙƒØªÙ‡ Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù„Ø£Ù†Ù‡ Ù†Øµ Ø­Ø±ØŒ Ø¨Ø³ Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø©.
    const database = [
        { type: "FV", fullTag: "01-FV-00001", data: { "Service": "RETURN OIL SLOPS TO CRUDE FEED PUMP", "Action": "FC", "HandJack": "YES", "PEFS": "J-001", "Location": "NEAR CRUDE FEED PUMP P-001A/B" } },
        { type: "FV", fullTag: "01-FV-00002", data: { "Service": "CRUDE FEED FROM CRUDE FEED PUMP", "Action": "FC", "HandJack": "YES", "PEFS": "J-001", "Location": "NEAR DEMULSIFIER INJECTION PACKAGE" } },
        { type: "FV", fullTag: "01-FV-00005", data: { "Service": "CRUDE FEED PUMP (P-0001) MIN FLOW", "Action": "FO", "HandJack": "YES", "PEFS": "J-001", "Location": "NEAR CRUDE FEED PUMP P-001A/B" } },
        { type: "FV", fullTag: "01-FV-00021A", data: { "Service": "FLASHED CRUDE PASS 1 TO CRUDE HEATER", "Action": "FL", "HandJack": "YES", "PEFS": "J-015", "Location": "HEATER STRUCTURE NO.4 TOP FLOOR" } },
        
        { type: "HV", fullTag: "01-HV-00030", data: { "Service": "ATH RESIDUE BYPASS TO EXCHANGER", "Action": "FO", "HandJack": "YES", "PEFS": "J-009-001", "Location": "NORTH SIDE OF V-0001" } },
        { type: "HV", fullTag: "01-HV-00125", data: { "Service": "DIESEL PRODUCT AIR COOLER", "Action": "-", "HandJack": "NO", "PEFS": "J-014-003", "Location": "NEAR E-0012E/F (SOUTH SIDE)" } },

        { type: "LV", fullTag: "01-LV-00005", data: { "Service": "WASH WATER FM DESALTER WASH WATER PUMP", "Action": "FC", "HandJack": "YES", "PEFS": "J-005", "Location": "NEAR P-0014A" } },
        
        { type: "PDV", fullTag: "01-PDV-00037", data: { "Service": "CRT FEED TO 1ST STG DSLTR STATIC MXR", "Action": "FC", "HandJack": "NO", "PEFS": "J-007-001", "Location": "BETWEEN V-0001 & V-0002" } },
        
        { type: "PV", fullTag: "01-PV-00006", data: { "Service": "PREFLASH VAPOR FROM CRUDE PREFLASH DRUM", "Action": "FC", "HandJack": "YES", "PEFS": "J-013-001", "Location": "FINFAN STRUCTURE MIDDLE" } },
        
        { type: "TV", fullTag: "01-TV-00367", data: { "Service": "AR RYP FR CRD / AR EXCHANGER", "Action": "FC", "HandJack": "NO", "PEFS": "J-054-009", "Location": "NEAR P-00128" } }
    ];

    // --- 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (State Management) ---
    let currentLang = localStorage.getItem('lang') || (navigator.language.startsWith('ar') ? 'ar' : 'en');
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', () => {
        applyLanguage(currentLang);
        populateTypes();
    });

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
    function toggleLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        localStorage.setItem('lang', currentLang);
        applyLanguage(currentLang);
        // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø¬Ù…Ø©
        populateTypes();
        if(document.getElementById('controlNumber').value) showData();
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø¹Ù„Ù‰ Ø§Ù„Ù†ØµÙˆØµ
    function applyLanguage(lang) {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        document.querySelectorAll('[data-key]').forEach(el => {
            el.textContent = translations[lang][el.getAttribute('data-key')];
        });
        
        document.getElementById('langBtn').textContent = translations[lang].langBtn;
    }

    // --- 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù… (Business Logic) ---

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù†Ø¸ÙŠÙ (Smart Number Parser)
    function getCleanNumber(fullTag) {
        // ÙŠØ£Ø®Ø° Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£Ø®ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø·Ø©ØŒ ÙˆÙŠØ­Ø°Ù Ø§Ù„Ø£ØµÙØ§Ø± Ø§Ù„Ù„ÙŠ Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        // 01-FV-00021A -> 00021A -> 21A
        const parts = fullTag.split('-');
        const lastPart = parts[parts.length - 1];
        return lastPart.replace(/^0+/, '');
    }

    const typeSelect = document.getElementById('controlType');
    const numSelect = document.getElementById('controlNumber');
    const table = document.getElementById('dataTable');
    const tableBody = document.getElementById('tableBody');
    const placeholder = document.getElementById('placeholder');

    function populateTypes() {
        const selectedValue = typeSelect.value; // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        typeSelect.innerHTML = `<option value="">${translations[currentLang].optSelect}</option>`;
        
        const types = [...new Set(database.map(item => item.type))].sort();
        
        types.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = translations[currentLang].types[type] || type;
            typeSelect.appendChild(option);
        });
        
        typeSelect.value = selectedValue; // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    }

    function populateNumbers() {
        const selectedType = typeSelect.value;
        numSelect.innerHTML = `<option value="">${translations[currentLang].optSelectNum}</option>`;
        numSelect.disabled = true;
        table.style.display = "none";
        placeholder.style.display = "block";

        if (selectedType) {
            const filteredItems = database.filter(item => item.type === selectedType);
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù†Ø·Ù‚ÙŠØ§Ù‹ (Numeric Sort)
            filteredItems.sort((a, b) => {
                return getCleanNumber(a.fullTag).localeCompare(getCleanNumber(b.fullTag), undefined, {numeric: true});
            });

            filteredItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.fullTag; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù‡ÙŠ Ø§Ù„ØªØ§Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„
                option.textContent = getCleanNumber(item.fullTag); // Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ù‡Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø®ØªØµØ±
                numSelect.appendChild(option);
            });
            numSelect.disabled = false;
        }
    }

    function showData() {
        const selectedTag = numSelect.value;
        tableBody.innerHTML = "";

        if (selectedTag) {
            const record = database.find(item => item.fullTag === selectedTag);
            
            if (record) {
                const t = translations[currentLang]; // Ø§Ø®ØªØµØ§Ø± Ù„Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                
                // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØªØ±ØªÙŠØ¨ Ø¹Ø±Ø¶Ù‡Ø§
                const fieldsToShow = [
                    { key: 'Service', label: t.fields.Service },
                    { key: 'Action', label: t.fields.Action, transform: (val) => t.actions[val] || val },
                    { key: 'HandJack', label: t.fields.HandJack },
                    { key: 'PEFS', label: t.fields.PEFS },
                    { key: 'Location', label: t.fields.Location }
                ];

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ù‚ Ø§Ù„ÙƒØ§Ù…Ù„ Ø£ÙˆÙ„ Ø´ÙŠ
                const tagRow = `
                    <tr>
                        <th>${t.fields.TagNo}</th>
                        <td><span class="tag-badge">${record.fullTag}</span></td>
                    </tr>
                `;
                tableBody.innerHTML += tagRow;

                fieldsToShow.forEach(field => {
                    let value = record.data[field.key];
                    if (field.transform) {
                        value = field.transform(value);
                    }
                    // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹
                    if (field.key === 'Location') value = 'ğŸ“ ' + value;

                    const row = `<tr><th>${field.label}</th><td>${value}</td></tr>`;
                    tableBody.innerHTML += row;
                });

                table.style.display = "table";
                placeholder.style.display = "none";
            }
        }
    }
</script>

</body>
</html>
